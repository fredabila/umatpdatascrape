<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Search and Filter</title>
    <style>
      .container {
        width: 80%;
        margin: 0 auto;
      }
      .search-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .search-container input,
      .search-container select,
      .search-container button {
        padding: 10px;
        font-size: 16px;
      }
      .student-list {
        margin-top: 20px;
      }
      .student {
        padding: 10px;
        border-bottom: 1px solid #ccc;
      }
      .pagination {
        margin-top: 20px;
        display: flex;
        justify-content: center;
      }
      .pagination button {
        padding: 10px;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Student Search and Filter</h1>

      <div class="search-container">
        <input
          type="text"
          id="searchInput"
          placeholder="Search by Index Number"
          onkeyup="filterStudents()"
        />
        <select id="schoolSelect" onchange="filterBySchool()">
          <option value="">Select School</option>
        </select>
        <button onclick="resetFilters()">Reset</button>
      </div>

      <div class="student-list" id="studentList">
        <!-- Student data will be displayed here -->
      </div>

      <div class="pagination" id="pagination">
        <!-- Pagination buttons will be here -->
      </div>
    </div>

    <script>
      let allStudents = [];
      let filteredStudents = [];
      let institutions = [];
      let currentPage = 1;
      const studentsPerPage = 20;

      // Fetching initial data
      window.onload = function () {
        fetchInstitutions();
        fetchStudents();
      };

      // Fetch institutions for the dropdown
      function fetchInstitutions() {
        fetch(
          "https://portal.umat.edu.gh/api-v1/live/admissions//api/Util/GetInstitutions"
        )
          .then((response) => response.json())
          .then((data) => {
            institutions = data;
            populateInstitutionDropdown();
          })
          .catch((error) =>
            console.error("Error fetching institutions:", error)
          );
      }

      // Populate the school select dropdown
      function populateInstitutionDropdown() {
        const schoolSelect = document.getElementById("schoolSelect");
        institutions.forEach((institution) => {
          const option = document.createElement("option");
          option.value = institution.ValueId;
          option.textContent = institution.DisplayValue;
          schoolSelect.appendChild(option);
        });
      }

      // Fetch all students (you should replace this with your actual API that fetches students)
      function fetchStudents() {
        // Simulating a fetch of 100 dummy students
        for (let i = 1; i <= 100; i++) {
          allStudents.push({
            indexNumber: String(i).padStart(4, "0"),
            name: `Student ${i}`,
            applicationId: 4000000 + i,
          });
        }
        filteredStudents = [...allStudents];
        renderStudents();
      }

      // Search and filter by index number
      function filterStudents() {
        const searchQuery = document
          .getElementById("searchInput")
          .value.toLowerCase();
        filteredStudents = allStudents.filter((student) =>
          student.indexNumber.includes(searchQuery)
        );
        currentPage = 1;
        renderStudents();
      }

      // Filter by school
      function filterBySchool() {
        const selectedSchoolId = document.getElementById("schoolSelect").value;
        if (selectedSchoolId) {
          filteredStudents = allStudents.filter((student) => {
            return fetch(
              `https://portal.umat.edu.gh/api-v1/live/admissions//api/Admission/GetApplicantExaminations?applicantId=${student.applicationId}`
            )
              .then((response) => response.json())
              .then((data) => {
                return data.SchoolCode === selectedSchoolId;
              })
              .catch((error) =>
                console.error("Error fetching applicant examinations:", error)
              );
          });
        } else {
          filteredStudents = [...allStudents];
        }
        currentPage = 1;
        renderStudents();
      }

      // Reset filters
      function resetFilters() {
        document.getElementById("searchInput").value = "";
        document.getElementById("schoolSelect").value = "";
        filteredStudents = [...allStudents];
        currentPage = 1;
        renderStudents();
      }

      // Pagination logic
      function renderStudents() {
        const studentList = document.getElementById("studentList");
        studentList.innerHTML = "";

        // Calculate which students to show on the current page
        const start = (currentPage - 1) * studentsPerPage;
        const end = start + studentsPerPage;
        const studentsToShow = filteredStudents.slice(start, end);

        studentsToShow.forEach((student) => {
          const div = document.createElement("div");
          div.className = "student";
          div.textContent = `${student.indexNumber}: ${student.name}`;
          studentList.appendChild(div);
        });

        renderPagination();
      }

      // Render pagination buttons
      function renderPagination() {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        const totalPages = Math.ceil(filteredStudents.length / studentsPerPage);

        // Previous button
        const prevButton = document.createElement("button");
        prevButton.textContent = "Previous";
        prevButton.disabled = currentPage === 1;
        prevButton.onclick = () => {
          if (currentPage > 1) {
            currentPage--;
            renderStudents();
          }
        };
        pagination.appendChild(prevButton);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
          const pageButton = document.createElement("button");
          pageButton.textContent = i;
          pageButton.disabled = i === currentPage;
          pageButton.onclick = () => {
            currentPage = i;
            renderStudents();
          };
          pagination.appendChild(pageButton);
        }

        // Next button
        const nextButton = document.createElement("button");
        nextButton.textContent = "Next";
        nextButton.disabled = currentPage === totalPages;
        nextButton.onclick = () => {
          if (currentPage < totalPages) {
            currentPage++;
            renderStudents();
          }
        };
        pagination.appendChild(nextButton);
      }
    </script>
  </body>
</html>
